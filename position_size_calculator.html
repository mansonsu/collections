<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>åˆç´„å€‰ä½å¤§å°è¨ˆç®—å™¨</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 16px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #020617;
      border-radius: 12px;
      padding: 20px 24px 28px;
      border: 1px solid #1e293b;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    h1 { font-size: 22px; margin-top: 0; margin-bottom: 6px; }
    .sub { font-size: 13px; color: #9ca3af; margin-bottom: 16px; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px 20px;
    }

    .field { display: flex; flex-direction: column; gap: 6px; }
    label { font-size: 13px; color: #e5e7eb; font-weight: 600; }

    /* æ­¢ç›ˆç¶  / æ­¢æç´… */
    .label-tp {
      color: #4ade80 !important;
      font-weight: 700;
    }
    .label-sl {
      color: #f87171 !important;
      font-weight: 700;
    }

    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
    }
    input::placeholder {
      color: #6b7280;
      font-size: 13px;
    }
    input:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
      outline: none;
    }

    .btn-row { display: flex; gap: 10px; margin: 14px 0; flex-wrap: wrap; }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      background: #38bdf8;
      color: #020617;
    }
    button.secondary {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #374151;
    }

    .error { font-size: 12px; color: #fecaca; margin-bottom: 6px; min-height: 16px; }

    .results-card {
      margin-top: 12px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: #020617;
      padding: 14px;
    }
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px 16px;
    }
    .result-item-title { font-size: 12px; color: #9ca3af; }
    .result-item-value { font-size: 15px; margin-top: 2px; }

    .divider { margin: 12px 0; border-top: 1px dashed #1f2933; }

    .footer-note { font-size: 11px; color: #6b7280; margin-top: 10px; }
  </style>
</head>

<body>
  <div class="container">
    <h1>åˆç´„å€‰ä½å¤§å°è¨ˆç®—å™¨</h1>
    <div class="sub">
      è‡ªå‹•è¨ˆç®—å€‰ä½åƒ¹å€¼ã€ä¿è­‰é‡‘ã€æ­¢ç›ˆ%ã€æ­¢ç›ˆé‡‘é¡ã€ç›ˆè™§æ¯” Rï¼Œä¸¦è‡ªå‹•åˆ¤æ–·å¤šç©ºæ–¹å‘ã€‚<br>
      â€» è‹¥ã€Œæœªå¡«æ­¢æã€ä½†æœ‰å¡«æ­¢ç›ˆï¼Œæœƒå‡è¨­ç›ˆè™§æ¯” 1:1 ä¾†æ¨ç®—æ­¢æåƒ¹ã€‚
    </div>

    <!-- è¼¸å…¥æ¬„ä½ -->
    <div class="grid">

      <div class="field">
        <label for="entryPrice">å…¥å ´åƒ¹ (USD)</label>
        <input id="entryPrice" type="number" step="0.0001" placeholder="ä¾‹å¦‚ï¼š10000" />
      </div>

      <div class="field">
        <label for="stopPrice" class="label-sl">æ­¢æåƒ¹ (USD)</label>
        <input id="stopPrice" type="number" step="0.0001" placeholder="å¯ç•™ç©ºè®“ç³»çµ±ç”¨ 1:1 ç›ˆè™§æ¯”åæ¨" />
      </div>

      <div class="field">
        <label for="takeProfitPrice" class="label-tp">æ­¢ç›ˆåƒ¹ (USD)</label>
        <input id="takeProfitPrice" type="number" step="0.0001" placeholder="ä¾‹å¦‚ï¼š11200" />
      </div>

      <div class="field">
        <label for="maxLoss">æœ€å¤§è™§æé‡‘é¡ (USD)</label>
        <input id="maxLoss" type="number" step="0.01" placeholder="ä¾‹å¦‚ï¼š150" />
      </div>

      <div class="field">
        <label for="leverage">æ§“æ¡¿å€æ•¸</label>
        <input id="leverage" type="number" step="0.1" placeholder="ä¾‹å¦‚ï¼š10" />
      </div>

    </div>

    <div class="btn-row">
      <button onclick="calculate()">è¨ˆç®—</button>
      <button class="secondary" onclick="fillExample()">å¡«å…¥ç¯„ä¾‹</button>
    </div>

    <div id="error" class="error"></div>

    <!-- çµæœå¡ç‰‡ -->
    <div class="results-card">

      <div class="results-grid">
        <div>
          <div class="result-item-title">è‡ªå‹•åˆ¤æ–·æ–¹å‘</div>
          <div id="autoDirection" class="result-item-value">â€”</div>
        </div>

        <div>
          <div class="result-item-title">æ­¢æè·é›¢ (%)</div>
          <div id="stopDistancePct" class="result-item-value">â€”</div>
        </div>

        <div>
          <div class="result-item-title">å€‰ä½åƒ¹å€¼ (USD)</div>
          <div id="positionValue" class="result-item-value">â€”</div>
        </div>

        <div>
          <div class="result-item-title">æ‰€éœ€ä¿è­‰é‡‘ (USD)</div>
          <div id="requiredMargin" class="result-item-value">â€”</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="results-grid">
        <div>
          <div class="result-item-title">æ­¢ç›ˆåˆ©æ½¤ (%)</div>
          <div id="takeProfitPct" class="result-item-value">â€”</div>
        </div>

        <div>
          <div class="result-item-title">æ­¢ç›ˆé‡‘é¡ (USD)</div>
          <div id="takeProfitUsd" class="result-item-value">â€”</div>
        </div>

        <div>
          <div class="result-item-title">ç›ˆè™§æ¯” (R)</div>
          <div id="rrr" class="result-item-value">â€”</div>
        </div>
      </div>

      <div class="footer-note">
        ç›ˆè™§æ¯” R = |æ­¢ç›ˆ - å…¥å ´| Ã· |å…¥å ´ - æ­¢æ|ã€‚<br>
        è‹¥æ­¢æç•™ç©ºä¸”æœ‰æ­¢ç›ˆï¼Œç³»çµ±æœƒç”¨ã€Œåƒ¹æ ¼è·é›¢ 1:1ã€ä¾†æ¨ç®—æ­¢æã€‚
      </div>

    </div>
  </div>

<script>
function formatNumber(n, d) {
  return isFinite(n) ? Number(n).toFixed(d) : "â€”";
}

function calculate() {
  const entry = parseFloat(entryPrice.value);
  let stop = parseFloat(stopPrice.value);
  const tp = parseFloat(takeProfitPrice.value);
  const maxLossV = parseFloat(maxLoss.value);
  const lev = parseFloat(leverage.value);

  const err = document.getElementById("error");
  err.textContent = "";

  // å¿…è¦æ¬„ä½ï¼šå…¥å ´åƒ¹ã€æœ€å¤§è™§æã€æ§“æ¡¿
  if ([entry, maxLossV, lev].some(v => isNaN(v))) {
    err.textContent = "è«‹å…ˆå¡«å¯«ã€Œå…¥å ´åƒ¹ã€æœ€å¤§è™§æé‡‘é¡ã€æ§“æ¡¿ã€é€™ä¸‰å€‹æ¬„ä½ã€‚";
    return;
  }

  // === è‹¥æ²’å¡«æ­¢æï¼Œä¸”æœ‰å¡«æ­¢ç›ˆ â†’ ç”¨ç›ˆè™§æ¯” 1:1 æ¨ç®—æ­¢æ ===
  if (isNaN(stop)) {
    if (isNaN(tp)) {
      err.textContent = "æœªè¼¸å…¥æ­¢æåƒ¹ï¼Œä¸”æœªè¼¸å…¥æ­¢ç›ˆåƒ¹ï¼Œç„¡æ³•ç”¨ç›ˆè™§æ¯” 1:1 æ¨ç®—æ­¢æã€‚";
      return;
    }

    if (tp === entry) {
      err.textContent = "æ­¢ç›ˆåƒ¹ä¸å¾—ç­‰æ–¼å…¥å ´åƒ¹ï¼Œç„¡æ³•æ¨ç®—æ–¹å‘èˆ‡æ­¢æã€‚";
      return;
    }

    const dirGuess = tp > entry ? "LONG" : "SHORT";
    const dist = Math.abs(tp - entry); // åƒ¹æ ¼è·é›¢ï¼ˆ1:1ï¼‰

    if (dirGuess === "LONG") {
      // å¤šå–®ï¼šæ­¢ç›ˆåœ¨ä¸Šæ–¹ â†’ æ­¢æå°ç¨±åœ¨ä¸‹æ–¹
      const candidate = entry - dist;
      if (candidate <= 0) {
        err.textContent = "ä»¥ç›ˆè™§æ¯” 1:1 è¨ˆç®—ï¼Œå¤šå–®æ­¢ææœƒä½æ–¼ç­‰æ–¼ 0ï¼Œè«‹èª¿æ•´æ­¢ç›ˆæˆ–æ‰‹å‹•è¼¸å…¥æ­¢æã€‚";
        return;
      }
      stop = candidate;
    } else {
      // ç©ºå–®ï¼šæ­¢ç›ˆåœ¨ä¸‹æ–¹ â†’ æ­¢æå°ç¨±åœ¨ä¸Šæ–¹
      stop = entry + dist;
    }

    stopPrice.value = stop.toFixed(4); // å¯«å›æ¬„ä½
  }

  // === è‡ªå‹•åˆ¤æ–·æ–¹å‘ï¼ˆå« emojiï¼‰ ===
  let directionLabel = "â€”";
  let dirType = "UNKNOWN";

  if (!isNaN(stop) && !isNaN(tp)) {
    if (stop < entry && tp > entry) {
      directionLabel = "ğŸŸ© LONGï¼ˆåšå¤šï¼‰";
      dirType = "LONG";
    } else if (stop > entry && tp < entry) {
      directionLabel = "ğŸŸ¥ SHORTï¼ˆåšç©ºï¼‰";
      dirType = "SHORT";
    } else {
      directionLabel = "âš ï¸ ç„¡æ³•åˆ¤æ–·ï¼ˆæ­¢ç›ˆæ­¢æé‚è¼¯ç•°å¸¸ï¼‰";
      dirType = "UNKNOWN";
    }
  } else if (!isNaN(stop)) {
    // åªæœ‰æ­¢æï¼Œæ²’æœ‰æ­¢ç›ˆæ™‚ï¼Œå–®ç´”ç”¨æ­¢æä½ç½®æ¨æ¸¬æ–¹å‘
    if (stop < entry) {
      directionLabel = "ğŸŸ© LONGï¼ˆåšå¤šï¼Œä¾æ­¢ææ¨æ¸¬ï¼‰";
      dirType = "LONG";
    } else if (stop > entry) {
      directionLabel = "ğŸŸ¥ SHORTï¼ˆåšç©ºï¼Œä¾æ­¢ææ¨æ¸¬ï¼‰";
      dirType = "SHORT";
    } else {
      directionLabel = "âš ï¸ ç„¡æ³•åˆ¤æ–·ï¼ˆæ­¢æç­‰æ–¼å…¥å ´ï¼‰";
      dirType = "UNKNOWN";
    }
  }

  autoDirection.textContent = directionLabel;

  const riskDist = Math.abs(entry - stop);
  const stopFrac = riskDist / entry;

  if (stopFrac === 0) {
    err.textContent = "æ­¢æä¸å¯ç­‰æ–¼å…¥å ´ã€‚";
    return;
  }

  const stopPct = stopFrac * 100;
  const posValue = maxLossV / stopFrac; // å€‰ä½åƒ¹å€¼
  const margin = posValue / lev;

  // === æ­¢ç›ˆ (%) + æ­¢ç›ˆé‡‘é¡ ===
  let tpPct = "â€”";
  let tpUsd = "â€”";

  if (!isNaN(tp) && dirType !== "UNKNOWN") {
    let pf = NaN;

    if (dirType === "LONG") pf = (tp - entry) / entry;
    else if (dirType === "SHORT") pf = (entry - tp) / entry;

    if (!isNaN(pf)) {
      tpPct = formatNumber(pf * 100, 2) + " %";
      tpUsd = formatNumber(posValue * pf, 2);
    }
  }

  // === R å€¼ ===
  let rr = "â€”";
  if (!isNaN(tp) && riskDist > 0) {
    const rewardDist = Math.abs(tp - entry);
    rr = formatNumber(rewardDist / riskDist, 2) + " R";
  }

  stopDistancePct.textContent = formatNumber(stopPct, 2) + " %";
  positionValue.textContent = formatNumber(posValue, 2);
  requiredMargin.textContent = formatNumber(margin, 2);
  takeProfitPct.textContent = tpPct;
  takeProfitUsd.textContent = tpUsd;
  rrr.textContent = rr;
}

function fillExample() {
  // ç¯„ä¾‹ï¼šå¤šå–®ï¼Œ1:1 æœƒè‡ªå‹•ç®—å‡ºæ­¢æ
  entryPrice.value = 10000;
  stopPrice.value = "";
  takeProfitPrice.value = 11300;
  maxLoss.value = 150;
  leverage.value = 20;
  calculate();
}
</script>

</body>
</html>
